---
- name: 清理 Redis 资源
  ansible.builtin.command: >
    kubectl delete {{ item.kind }} {{ item.name }} -n {{ namespace }} --ignore-not-found=true
  loop:
    - kind: Deployment
      name: "{{ redis_name }}"
    - kind: StatefulSet
      name: "{{ redis_name }}"
    - kind: ReplicaSet
      name: "{{ redis_name }}-.*"
    - kind: Service
      name: "{{ redis_name }}-.*"
    - kind: ConfigMap
      name: "{{ redis_name }}-.*"
    - kind: Secret
      name: "{{ redis_name }}-.*"
    - kind: PersistentVolumeClaim
      name: "{{ redis_name }}-.*"
    - kind: Job
      name: "{{ redis_name }}-.*"
    - kind: PersistentVolumeClaim
      name: "{{ redis_name }}-.*"
    - kind: PersistentVolume
      name: "{{ redis_name }}-.*"
  failed_when: false
  run_once: true